        // const allProducts = [
        //     { id: 'mac-1', name: 'MacBook Pro 16"', price: 2499, image: 'https://placehold.co/600x400/f5f5f7/1d1d1f?text=MacBook+Pro', description: 'Apple M2 Pro chip. Supercharged for pros.', category: 'mac' },
        //     { id: 'mac-2', name: 'MacBook Air 13"', price: 1199, image: 'https://placehold.co/600x400/f5f5f7/1d1d1f?text=MacBook+Air', description: 'Light. Speed. Power.', category: 'mac' },
        //     { id: 'mac-3', name: 'MacBook Air M1', price: 999, image: 'https://placehold.co/600x400/f5f5f7/1d1d1f?text=MacBook+Air+M1', description: 'The M1 chip changes everything.', category: 'mac' },
        //     { id: 'mac-4', name: 'iMac 24"', price: 1299, image: 'https://placehold.co/600x400/f5f5f7/1d1d1f?text=iMac+24', description: 'Colorful. Powerful. Personal.', category: 'mac' },
        //     { id: 'ipad-1', name: 'iPad Pro', price: 799, image: 'https://placehold.co/600x400/f5f5f7/1d1d1f?text=iPad+Pro', description: 'Supercharged by M2 chip.', category: 'ipad' },
        //     { id: 'ipad-2', name: 'iPad Air', price: 599, image: 'https://placehold.co/600x400/f5f5f7/1d1d1f?text=iPad+Air', description: 'Light. Bright. Full of might.', category: 'ipad' },
        //     { id: 'ipad-3', name: 'iPad Air (5th Gen)', price: 599, image: 'https://placehold.co/600x400/f5f5f7/1d1d1f?text=iPad+Air+M1', description: 'Supercharged by the Apple M1 chip.', category: 'ipad' },
        //     { id: 'iphone-1', name: 'iPhone 15 Pro Max', price: 1199, image: 'https://placehold.co/600x400/f5f5f7/1d1d1f?text=iPhone+15+Pro+Max', description: 'Titanium. Strong. Light. Pro.', category: 'iphone' },
        //     { id: 'iphone-2', name: 'iPhone 15', price: 899, image: 'https://placehold.co/600x400/f5f5f7/1d1d1f?text=iPhone+15', description: 'Dynamic Island. 48MP Main camera.', category: 'iphone' },
        //     { id: 'iphone-3', name: 'iPhone 13', price: 799, image: 'https://placehold.co/600x400/f5f5f7/1d1d1f?text=iPhone+13', description: 'Powerful. Durable. Essential.', category: 'iphone' },
        //     { id: 'watch-1', name: 'Apple Watch Ultra 2', price: 799, image: 'https://placehold.co/600x400/f5f5f7/1d1d1f?text=Watch+Ultra+2', description: 'Next-level adventure.', category: 'watch' },
        //     { id: 'watch-2', name: 'Apple Watch SE', price: 249, image: 'https://placehold.co/600x400/f5f5f7/1d1d1f?text=Watch+SE', description: 'A great deal to love.', category: 'watch' },
        //     { id: 'watch-3', name: 'Apple Watch Series 9', price: 399, image: 'https://placehold.co/600x400/f5f5f7/1d1d1f?text=Watch+Series+9', description: 'A more powerful way to stay connected.', category: 'watch' },
        //     { id: 'other-1', name: 'AirPods Pro (2nd Gen)', price: 249, image: 'https://placehold.co/600x400/f5f5f7/1d1d1f?text=AirPods+Pro', description: 'Rebuilt from the sound up.', category: 'other' },
        //     // 2020 Products
        //     {
        //         id: 1,
        //         name: "iPhone 12 Pro",
        //         description: "A14 Bionic chip, Pro camera system, 5G capable",
        //         price: 999,
        //         image: "https://placehold.co/600x400/f5f5f7/1d1d1f?text=iPhone+12+Pro",
        //         category: "phones",
        //         year: 2020
        //     },
        //     {
        //         id: 2,
        //         name: "MacBook Air M1",
        //         description: "Apple M1 chip, 13-inch Retina display, 18-hour battery life",
        //         price: 999,
        //         image: "https://placehold.co/600x400/f5f5f7/1d1d1f?text=MacBook+Air+M1",
        //         category: "laptops",
        //         year: 2020
        //     },
        //     {
        //         id: 3,
        //         name: "iPad Air (4th generation)",
        //         description: "A14 Bionic chip, 10.9-inch Liquid Retina display, USB-C",
        //         price: 599,
        //         image: "https://placehold.co/600x400/f5f5f7/1d1d1f?text=iPad+Air+4",
        //         category: "tablets",
        //         year: 2020
        //     },
        //     {
        //         id: 4,
        //         name: "Apple Watch Series 6",
        //         description: "Blood oxygen sensor, Always-On Retina display, GPS",
        //         price: 399,
        //         image: "https://placehold.co/600x400/f5f5f7/1d1d1f?text=Watch+Series+6",
        //         category: "watches",
        //         year: 2020
        //     },

        //     // 2021 Products
        //     {
        //         id: 5,
        //         name: "iPhone 13 Pro",
        //         description: "A15 Bionic chip, ProMotion display, Cinematic mode",
        //         price: 999,
        //         image: "https://placehold.co/600x400/f5f5f7/1d1d1f?text=iPhone+13+Pro",
        //         category: "phones",
        //         year: 2021
        //     },
        //     {
        //         id: 6,
        //         name: "MacBook Pro 14"",
        //         description: "M1 Pro/Max chip, Liquid Retina XDR display, ProMotion",
        //         price: 1999,
        //         image: "https://placehold.co/600x400/f5f5f7/1d1d1f?text=MacBook+Pro+14",
        //         category: "laptops",
        //         year: 2021
        //     },
        //     {
        //         id: 7,
        //         name: "iPad Pro M1",
        //         description: "M1 chip, 12.9-inch Liquid Retina XDR display, Thunderbolt",
        //         price: 1099,
        //         image: "https://placehold.co/600x400/f5f5f7/1d1d1f?text=iPad+Pro+M1",
        //         category: "tablets",
        //         year: 2021
        //     },
        //     {
        //         id: 8,
        //         name: "Apple Watch Series 7",
        //         description: "Larger display, faster charging, more durable design",
        //         price: 399,
        //         image: "https://placehold.co/600x400/f5f5f7/1d1d1f?text=Watch+Series+7",
        //         category: "watches",
        //         year: 2021
        //     },

        //     // 2022 Products
        //     {
        //         id: 9,
        //         name: "iPhone 14 Pro",
        //         description: "A16 Bionic chip, Dynamic Island, 48MP camera",
        //         price: 999,
        //         image: "https://placehold.co/600x400/f5f5f7/1d1d1f?text=iPhone+14+Pro",
        //         category: "phones",
        //         year: 2022
        //     },
        //     {
        //         id: 10,
        //         name: "MacBook Air M2",
        //         description: "M2 chip, 13.6-inch Liquid Retina display, MagSafe",
        //         price: 1199,
        //         image: "https://placehold.co/600x400/f5f5f7/1d1d1f?text=MacBook+Air+M2",
        //         category: "laptops",
        //         year: 2022
        //     },
        //     {
        //         id: 11,
        //         name: "iPad Air (5th generation)",
        //         description: "M1 chip, 10.9-inch Liquid Retina display, 5G",
        //         price: 599,
        //         image: "https://placehold.co/600x400/f5f5f7/1d1d1f?text=iPad+Air+5",
        //         category: "tablets",
        //         year: 2022
        //     },
        //     {
        //         id: 12,
        //         name: "Apple Watch Ultra",
        //         description: "Titanium case, dual-frequency GPS, 36-hour battery",
        //         price: 799,
        //         image: "https://placehold.co/600x400/f5f5f7/1d1d1f?text=Watch+Ultra",
        //         category: "watches",
        //         year: 2022
        //     },

        //     // 2023 Products
        //     {
        //         id: 13,
        //         name: "iPhone 15 Pro",
        //         description: "A17 Pro chip, Titanium design, USB-C, Action button",
        //         price: 999,
        //         image: "https://placehold.co/600x400/f5f5f7/1d1d1f?text=iPhone+15+Pro",
        //         category: "phones",
        //         year: 2023
        //     },
        //     {
        //         id: 14,
        //         name: "MacBook Pro 16" M3",
        //         description: "M3 Pro/Max chip, Space Black finish, 22-hour battery",
        //         price: 2499,
        //         image: "https://placehold.co/600x400/f5f5f7/1d1d1f?text=MacBook+Pro+16+M3",
        //         category: "laptops",
        //         year: 2023
        //     },
        //     {
        //         id: 15,
        //         name: "iPad Pro M2",
        //         description: "M2 chip, 12.9-inch Liquid Retina XDR, Apple Pencil hover",
        //         price: 1099,
        //         image: "https://placehold.co/600x400/f5f5f7/1d1d1f?text=iPad+Pro+M2",
        //         category: "tablets",
        //         year: 2023
        //     },
        //     {
        //         id: 16,
        //         name: "Apple Watch Series 9",
        //         description: "S9 chip, Double tap gesture, brighter display",
        //         price: 399,
        //         image: "https://placehold.co/600x400/f5f5f7/1d1d1f?text=Watch+Series+9",
        //         category: "watches",
        //         year: 2023
        //     },

        //     // 2024 Products (Projected)
        //     {
        //         id: 17,
        //         name: "iPhone 16 Pro",
        //         description: "A18 Pro chip, Periscope camera, AI features",
        //         price: 1099,
        //         image: "https://placehold.co/600x400/f5f5f7/1d1d1f?text=iPhone+16+Pro",
        //         category: "phones",
        //         year: 2024
        //     },
        //     {
        //         id: 18,
        //         name: "MacBook Air M4",
        //         description: "M4 chip, OLED display, AI capabilities",
        //         price: 1299,
        //         image: "https://placehold.co/600x400/f5f5f7/1d1d1f?text=MacBook+Air+M4",
        //         category: "laptops",
        //         year: 2024
        //     },
        //     {
        //         id: 19,
        //         name: "iPad Pro M3",
        //         description: "M3 chip, OLED display, Thunderbolt 4",
        //         price: 1199,
        //         image: "https://placehold.co/600x400/f5f5f7/1d1d1f?text=iPad+Pro+M3",
        //         category: "tablets",
        //         year: 2024
        //     },
        //     {
        //         id: 20,
        //         name: "Apple Watch Series 10",
        //         description: "S10 chip, Blood pressure monitoring, MicroLED display",
        //         price: 449,
        //         image: "https://placehold.co/600x400/f5f5f7/1d1d1f?text=Watch+Series+10",
        //         category: "watches",
        //         year: 2024
        //     },

        //     // 2025 Products (Projected)
        //     {
        //         id: 21,
        //         name: "iPhone 17 Pro",
        //         description: "A19 Pro chip, Under-display Face ID, AR features",
        //         price: 1199,
        //         image: "https://placehold.co/600x400/f5f5f7/1d1d1f?text=iPhone+17+Pro",
        //         category: "phones",
        //         year: 2025
        //     },
        //     {
        //         id: 22,
        //         name: "MacBook Pro M5",
        //         description: "M5 chip, Neural Engine, Advanced AI features",
        //         price: 2799,
        //         image: "https://placehold.co/600x400/f5f5f7/1d1d1f?text=MacBook+Pro+M5",
        //         category: "laptops",
        //         year: 2025
        //     },
        //     {
        //         id: 23,
        //         name: "iPad Pro M4",
        //         description: "M4 chip, Foldable display, Advanced AR",
        //         price: 1299,
        //         image: "https://placehold.co/600x400/f5f5f7/1d1d1f?text=iPad+Pro+M4",
        //         category: "tablets",
        //         year: 2025
        //     },
        //     {
        //         id: 24,
        //         name: "Apple Watch Series 11",
        //         description: "S11 chip, Glucose monitoring, Advanced health features",
        //         price: 499,
        //         image: "https://placehold.co/600x400/f5f5f7/1d1d1f?text=Watch+Series+11",
        //         category: "watches",
        //         year: 2025
        //     }
        // ];
        let productsFromAPI = []; // Variabilă pentru a stoca produsele preluate de la API
        let currentCategory = 'all';
        let currentSort = 'default';
        let lastFiltered = []; // Va fi populat cu produsele de la API

        // Funcția principală pentru a prelua și afișa produsele
        async function fetchAndRenderProducts() {
            try {
                const response = await fetch('http://localhost:3000/api/products');
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                productsFromAPI = await response.json();
                console.log('Produse preluate de la API:', productsFromAPI);

                // Inițial, afișăm toate produsele preluate de la API
                showCategory(currentCategory, document.querySelector('.nav-links .active')); // Aici trebuie să te asiguri că .active e corect
            } catch (error) {
                console.error('Eroare la preluarea produselor:', error);
                const productsContainer = document.getElementById('products-container');
                if (productsContainer) {
                    productsContainer.innerHTML = '<p>Eroare la încărcarea produselor. Asigură-te că serverul backend rulează și baza de date este conectată.</p>';
                }
            }
        }

        function renderProducts(productsToRender) {
            const productsContainer = document.getElementById('products-container');
            productsContainer.innerHTML = ''; // Golim containerul

            if (productsToRender.length === 0) {
                productsContainer.innerHTML = '<p>Nu s-au găsit produse în această categorie sau cu aceste criterii de sortare.</p>';
                return;
            }

            productsToRender.forEach(product => {
                const productCard = document.createElement('div');
                productCard.classList.add('grid-item');
                // Facem întregul card un link către pagina produsului
                productCard.innerHTML = `
                    <a href="product.html?id=${product.product_id}" class="product-card-link">
                        <img src="${product.image_url}" alt="${product.name}" class="product-image"/>
                        <h2 class="product-item-name">${product.name}</h2>
                        <p class="product-price">$${parseFloat(product.price).toFixed(2)}</p>
                    </a>
                    <button class="add-to-cart" data-product-id="${product.product_id}">Add to Cart</button>
                `;
                productsContainer.appendChild(productCard);
            });
        }

        function showCategory(category, el) {
            // Actualizăm clasa 'active' pentru navigație
            const navLinks = document.querySelectorAll('.nav-links a');
            navLinks.forEach(link => link.classList.remove('active'));
            if (el) {
                el.classList.add('active');
            } else { // Dacă nu e dat un element, căutăm cel corect
                const defaultActiveLink = document.querySelector(`.nav-links a[onclick*="showCategory('${category}')"]`);
                if (defaultActiveLink) {
                    defaultActiveLink.classList.add('active');
                }
            }

            currentCategory = category;
            let filteredProducts = [];

            if (category === 'all') {
                filteredProducts = productsFromAPI; // Folosim produsele de la API
            } else {
                // Filtrează după categoria primită. Asigură-te că 'category' din API corespunde cu 'category' aici.
                filteredProducts = productsFromAPI.filter(product => product.category === category);
            }

            lastFiltered = filteredProducts; // Salvăm produsele filtrate
            sortProducts(currentSort); // Aplică sortarea curentă
        }

        function sortProducts(sortBy) {
            currentSort = sortBy;
            let sorted = [...lastFiltered]; // Sortăm produsele filtrate

            switch (sortBy) {
                case 'price-low':
                    sorted.sort((a, b) => a.price - b.price);
                    break;
                case 'price-high':
                    sorted.sort((a, b) => b.price - a.price);
                    break;
                case 'name':
                    sorted.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'default':
                default:
                    // Poți adăuga o sortare implicită aici dacă ai un câmp 'created_at' sau similar
                    break;
            }
            renderProducts(sorted); // Redesenăm produsele sortate
        }

        // Inițializăm la încărcarea paginii
        document.addEventListener('DOMContentLoaded', () => {
            fetchAndRenderProducts(); // Preia și afișează produsele de la API

            // Event listener pentru sortare
            const sortSelect = document.getElementById('sort-products');
            if (sortSelect) {
                sortSelect.addEventListener('change', (e) => {
                    sortProducts(e.target.value);
                });
            }

            // Aici ar trebui să inițiezi și logica pentru coș (dacă nu e deja într-un fișier separat)
            // ex: updateCartCount();
        });

        // Funcția addToCart și updateCartCount (rămân ca și până acum, dar trebuie să le adaptezi dacă folosești o bază de date pentru coș)
        let cart = JSON.parse(localStorage.getItem('cart')) || [];

        function addToCart(product) {
            const existingItem = cart.find(item => item.id === product.product_id);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                // Cream un obiect item cu structura asteptata de checkout.html
                const cartItem = {
                    id: product.product_id,
                    name: product.name,
                    description: product.description,
                    price: parseFloat(product.price),
                    image: product.image_url,
                    quantity: 1
                };
                cart.push(cartItem);
            }
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount(true);
            console.log('Added to cart:', product.name);
        }

        function updateCartCount(animate) {
            const cartCountElement = document.querySelector('.cart-count');
            if (cartCountElement) {
                const currentCart = JSON.parse(localStorage.getItem('cart')) || [];
                const totalItems = currentCart.reduce((sum, item) => sum + item.quantity, 0);
                
                if (totalItems > 0) {
                    cartCountElement.textContent = totalItems;
                    cartCountElement.style.display = 'flex'; // Afisam elementul
                } else {
                    cartCountElement.textContent = '0'; // Optionally keep 0, or just let it be empty if hidden by CSS
                    cartCountElement.style.display = 'none'; // Ascundem elementul
                }

                if (animate) {
                    cartCountElement.classList.add('animate');
                    cartCountElement.addEventListener('animationend', () => {
                        cartCountElement.classList.remove('animate');
                    }, { once: true });
                }
            }
        }

        // Adaugăm event listener pentru butoanele "Add to Cart" dinamic
        // Trebuie să delegăm evenimentul, deoarece butoanele sunt adăugate dinamic
        document.addEventListener('click', (event) => {
            if (event.target.classList.contains('add-to-cart')) {
                const productId = event.target.dataset.productId;
                const product = productsFromAPI.find(p => p.product_id == productId); // Folosim productsFromAPI
                if (product) {
                    addToCart(product);
                    // Adaugă clasa de succes vizuală (opțional)
                    event.target.classList.add('success');
                    event.target.textContent = 'Added!';
                    setTimeout(() => {
                        event.target.classList.remove('success');
                        event.target.textContent = 'Add to Cart';
                    }, 1000);
                }
            }
        });

        // Inițializăm numărul de produse din coș la încărcare
        updateCartCount(false);
